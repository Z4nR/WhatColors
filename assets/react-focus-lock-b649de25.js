import{r as n}from"./react-ce22c937.js";import{_ as T,c as Fe}from"./@babel-d7b299da.js";import{F as he,a as be,s as _,f as j,g as ge,b as pe}from"./focus-lock-b0fcf19c.js";import{c as W,a as Ee}from"./use-sidecar-6c3079da.js";import{u as Pe}from"./use-callback-ref-777fcfee.js";import{w as Ce}from"./react-clientside-effect-7ce167a9.js";var S={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},N=W({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),q=W(),Le=W(),Ie=Ee({async:!0}),ke=[],B=n.forwardRef(function(e,t){var a,u=n.useState(),i=u[0],d=u[1],l=n.useRef(),p=n.useRef(!1),c=n.useRef(null),s=e.children,o=e.disabled,L=e.noFocusGuards,v=e.persistentFocus,E=e.crossFrame,f=e.autoFocus;e.allowTextSelection;var m=e.group,y=e.className,X=e.whiteList,Y=e.hasPositiveIndices,D=e.shards,Z=D===void 0?ke:D,H=e.as,ee=H===void 0?"div":H,M=e.lockProps,te=M===void 0?{}:M,re=e.sideCar,I=e.returnFocus,ne=e.focusOptions,w=e.onActivation,x=e.onDeactivation,ae=n.useState({}),oe=ae[0],ue=n.useCallback(function(){c.current=c.current||document&&document.activeElement,l.current&&w&&w(l.current),p.current=!0},[w]),ie=n.useCallback(function(){p.current=!1,x&&x(l.current)},[x]);n.useEffect(function(){o||(c.current=null)},[]);var se=n.useCallback(function(F){var P=c.current;if(P&&P.focus){var O=typeof I=="function"?I(P):I;if(O){var U=typeof O=="object"?O:void 0;c.current=null,F?Promise.resolve().then(function(){return P.focus(U)}):P.focus(U)}}},[I]),ce=n.useCallback(function(F){p.current&&N.useMedium(F)},[]),de=q.useMedium,fe=n.useCallback(function(F){l.current!==F&&(l.current=F,d(F))},[]),le=T((a={},a[he]=o&&"disabled",a[be]=m,a),te),A=L!==!0,ve=A&&L!=="tail",me=Pe([t,fe]);return n.createElement(n.Fragment,null,A&&[n.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:o?-1:0,style:S}),Y?n.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:o?-1:1,style:S}):null],!o&&n.createElement(re,{id:oe,sideCar:Ie,observed:i,disabled:o,persistentFocus:v,crossFrame:E,autoFocus:f,whiteList:X,shards:Z,onActivation:ue,onDeactivation:ie,returnFocus:se,focusOptions:ne}),n.createElement(ee,T({ref:me},le,{className:y,onBlur:de,onFocus:ce}),s),ve&&n.createElement("div",{"data-focus-guard":!0,tabIndex:o?-1:0,style:S}))});B.propTypes={};B.defaultProps={children:void 0,disabled:!1,returnFocus:!1,focusOptions:void 0,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,hasPositiveIndices:void 0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};const z=B;function G(r){setTimeout(r,1)}var ye=function(){return document&&document.activeElement===document.body},we=function(){return ye()||pe()},b=null,h=null,g=null,C=!1,xe=function(){return!0},Oe=function(e){return(b.whiteList||xe)(e)},Se=function(e,t){g={observerNode:e,portaledElement:t}},Te=function(e){return g&&g.portaledElement===e};function $(r,e,t,a){var u=null,i=r;do{var d=a[i];if(d.guard)d.node.dataset.focusAutoGuard&&(u=d);else if(d.lockItem){if(i!==r)return;u=null}else break}while((i+=t)!==e);u&&(u.node.tabIndex=0)}var We=function(e){return e&&"current"in e?e.current:e},Be=function(e){return e?!!C:C==="meanwhile"},Ge=function r(e,t,a){return t&&(t.host===e&&(!t.activeElement||a.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,a))},Re=function(e,t){return t.some(function(a){return Ge(e,a,a)})},k=function(){var e=!1;if(b){var t=b,a=t.observed,u=t.persistentFocus,i=t.autoFocus,d=t.shards,l=t.crossFrame,p=t.focusOptions,c=a||g&&g.portaledElement,s=document&&document.activeElement;if(c){var o=[c].concat(d.map(We).filter(Boolean));if((!s||Oe(s))&&(u||Be(l)||!we()||!h&&i)&&(c&&!(j(o)||s&&Re(s,o)||Te(s))&&(document&&!h&&s&&!i?(s.blur&&s.blur(),document.body.focus()):(e=_(o,h,{focusOptions:p}),g={})),C=!1,h=document&&document.activeElement),document){var L=document&&document.activeElement,v=ge(o),E=v.map(function(f){var m=f.node;return m}).indexOf(L);E>-1&&(v.filter(function(f){var m=f.guard,y=f.node;return m&&y.dataset.focusAutoGuard}).forEach(function(f){var m=f.node;return m.removeAttribute("tabIndex")}),$(E,v.length,1,v),$(E,-1,-1,v))}}}return e},J=function(e){k()&&e&&(e.stopPropagation(),e.preventDefault())},R=function(){return G(k)},De=function(e){var t=e.target,a=e.currentTarget;a.contains(t)||Se(a,t)},He=function(){return null},K=function(){C="just",G(function(){C="meanwhile"})},Me=function(){document.addEventListener("focusin",J),document.addEventListener("focusout",R),window.addEventListener("blur",K)},Ae=function(){document.removeEventListener("focusin",J),document.removeEventListener("focusout",R),window.removeEventListener("blur",K)};function Ue(r){return r.filter(function(e){var t=e.disabled;return!t})}function $e(r){var e=r.slice(-1)[0];e&&!b&&Me();var t=b,a=t&&e&&e.id===t.id;b=e,t&&!a&&(t.onDeactivation(),r.filter(function(u){var i=u.id;return i===t.id}).length||t.returnFocus(!e)),e?(h=null,(!a||t.observed!==e.observed)&&e.onActivation(),k(),G(k)):(Ae(),h=null)}N.assignSyncMedium(De);q.assignMedium(R);Le.assignMedium(function(r){return r({moveFocusInside:_,focusInside:j})});const _e=Ce(Ue,$e)(He);var Q=n.forwardRef(function(e,t){return n.createElement(z,T({sideCar:_e,ref:t},e))}),V=z.propTypes||{};V.sideCar;Fe(V,["sideCar"]);Q.propTypes={};const Qe=Q;export{Qe as F};
