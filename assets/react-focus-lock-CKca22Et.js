import{r as n}from"./react-CCjLKhKT.js";import{_ as W,c as ve}from"./@babel-BrOaYSQ9.js";import{F as me,a as he,f as $,s as j,g as Fe,b as be}from"./focus-lock-Ck_CDjsp.js";import{c as B,a as ge}from"./use-sidecar-BTTstiWC.js";import{u as pe}from"./use-callback-ref-DD7Rqd_a.js";import{w as Ee}from"./react-clientside-effect-CkzihD8P.js";var T={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},N=B({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),q=B(),Pe=B(),Ce=ge({async:!0}),ye=[],x=n.forwardRef(function(e,t){var a,u=n.useState(),i=u[0],d=u[1],l=n.useRef(),p=n.useRef(!1),c=n.useRef(null),s=e.children,o=e.disabled,y=e.noFocusGuards,v=e.persistentFocus,E=e.crossFrame,f=e.autoFocus;e.allowTextSelection;var m=e.group,S=e.className,Q=e.whiteList,V=e.hasPositiveIndices,H=e.shards,X=H===void 0?ye:H,D=e.as,Y=D===void 0?"div":D,M=e.lockProps,Z=M===void 0?{}:M,ee=e.sideCar,I=e.returnFocus,te=e.focusOptions,k=e.onActivation,w=e.onDeactivation,re=n.useState({}),ne=re[0],ae=n.useCallback(function(){c.current=c.current||document&&document.activeElement,l.current&&k&&k(l.current),p.current=!0},[k]),oe=n.useCallback(function(){p.current=!1,w&&w(l.current)},[w]);n.useEffect(function(){o||(c.current=null)},[]);var ue=n.useCallback(function(h){var P=c.current;if(P&&P.focus){var O=typeof I=="function"?I(P):I;if(O){var U=typeof O=="object"?O:void 0;c.current=null,h?Promise.resolve().then(function(){return P.focus(U)}):P.focus(U)}}},[I]),ie=n.useCallback(function(h){p.current&&N.useMedium(h)},[]),se=q.useMedium,ce=n.useCallback(function(h){l.current!==h&&(l.current=h,d(h))},[]),de=W((a={},a[me]=o&&"disabled",a[he]=m,a),Z),A=y!==!0,fe=A&&y!=="tail",le=pe([t,ce]);return n.createElement(n.Fragment,null,A&&[n.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:o?-1:0,style:T}),V?n.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:o?-1:1,style:T}):null],!o&&n.createElement(ee,{id:ne,sideCar:Ce,observed:i,disabled:o,persistentFocus:v,crossFrame:E,autoFocus:f,whiteList:Q,shards:X,onActivation:ae,onDeactivation:oe,returnFocus:ue,focusOptions:te}),n.createElement(Y,W({ref:le},de,{className:S,onBlur:se,onFocus:ie}),s),fe&&n.createElement("div",{"data-focus-guard":!0,tabIndex:o?-1:0,style:T}))});x.propTypes={};x.defaultProps={children:void 0,disabled:!1,returnFocus:!1,focusOptions:void 0,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,hasPositiveIndices:void 0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};function G(r){setTimeout(r,1)}var Ie=function(){return document&&document.activeElement===document.body},Le=function(){return Ie()||be()},b=null,F=null,g=null,C=!1,xe=function(){return!0},Se=function(e){return(b.whiteList||xe)(e)},ke=function(e,t){g={observerNode:e,portaledElement:t}},we=function(e){return g&&g.portaledElement===e};function _(r,e,t,a){var u=null,i=r;do{var d=a[i];if(d.guard)d.node.dataset.focusAutoGuard&&(u=d);else if(d.lockItem){if(i!==r)return;u=null}else break}while((i+=t)!==e);u&&(u.node.tabIndex=0)}var Oe=function(e){return e&&"current"in e?e.current:e},Te=function(e){return e?!!C:C==="meanwhile"},We=function r(e,t,a){return t&&(t.host===e&&(!t.activeElement||a.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,a))},Be=function(e,t){return t.some(function(a){return We(e,a,a)})},L=function(){var e=!1;if(b){var t=b,a=t.observed,u=t.persistentFocus,i=t.autoFocus,d=t.shards,l=t.crossFrame,p=t.focusOptions,c=a||g&&g.portaledElement,s=document&&document.activeElement;if(c){var o=[c].concat(d.map(Oe).filter(Boolean));if((!s||Se(s))&&(u||Te(l)||!Le()||!F&&i)&&(c&&!($(o)||s&&Be(s,o)||we(s))&&(document&&!F&&s&&!i?(s.blur&&s.blur(),document.body.focus()):(e=j(o,F,{focusOptions:p}),g={})),C=!1,F=document&&document.activeElement),document){var y=document&&document.activeElement,v=Fe(o),E=v.map(function(f){var m=f.node;return m}).indexOf(y);E>-1&&(v.filter(function(f){var m=f.guard,S=f.node;return m&&S.dataset.focusAutoGuard}).forEach(function(f){var m=f.node;return m.removeAttribute("tabIndex")}),_(E,v.length,1,v),_(E,-1,-1,v))}}}return e},z=function(e){L()&&e&&(e.stopPropagation(),e.preventDefault())},R=function(){return G(L)},Ge=function(e){var t=e.target,a=e.currentTarget;a.contains(t)||ke(a,t)},Re=function(){return null},J=function(){C="just",G(function(){C="meanwhile"})},He=function(){document.addEventListener("focusin",z),document.addEventListener("focusout",R),window.addEventListener("blur",J)},De=function(){document.removeEventListener("focusin",z),document.removeEventListener("focusout",R),window.removeEventListener("blur",J)};function Me(r){return r.filter(function(e){var t=e.disabled;return!t})}function Ae(r){var e=r.slice(-1)[0];e&&!b&&He();var t=b,a=t&&e&&e.id===t.id;b=e,t&&!a&&(t.onDeactivation(),r.filter(function(u){var i=u.id;return i===t.id}).length||t.returnFocus(!e)),e?(F=null,(!a||t.observed!==e.observed)&&e.onActivation(),L(),G(L)):(De(),F=null)}N.assignSyncMedium(Ge);q.assignMedium(R);Pe.assignMedium(function(r){return r({moveFocusInside:j,focusInside:$})});const Ue=Ee(Me,Ae)(Re);var _e=n.forwardRef(function(e,t){return n.createElement(x,W({sideCar:Ue,ref:t},e))}),K=x.propTypes||{};K.sideCar;ve(K,["sideCar"]);_e.propTypes={};export{_e as F};
