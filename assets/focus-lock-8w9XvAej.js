var j="data-focus-lock",dr="data-focus-lock-disabled",lr="data-no-focus-lock",sr="data-autofocus-inside",br="data-no-autofocus",b=function(r){for(var n=Array(r.length),e=0;e<r.length;++e)n[e]=r[e];return n},y=function(r){return Array.isArray(r)?r:[r]},X=function(r){return Array.isArray(r)?r[0]:r},mr=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var n=window.getComputedStyle(r,null);return!n||!n.getPropertyValue?!1:n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"},Z=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},$=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},hr=function(r){return r.hasAttribute("inert")},gr=function(r,n){return!r||$(r)||!mr(r)&&!hr(r)&&n(Z(r))},rr=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=gr(n,rr.bind(void 0,r));return r.set(n,t),t},xr=function(r,n){return r&&!$(r)?pr(r)?n(Z(r)):!1:!0},nr=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=xr(n,nr.bind(void 0,r));return r.set(n,t),t},er=function(r){return r.dataset},Or=function(r){return r.tagName==="BUTTON"},tr=function(r){return r.tagName==="INPUT"},ur=function(r){return tr(r)&&r.type==="radio"},yr=function(r){return!((tr(r)||Or(r))&&(r.type==="hidden"||r.disabled))},pr=function(r){var n=r.getAttribute(br);return![!0,"true",""].includes(n)},U=function(r){var n;return!!(r&&(!((n=er(r))===null||n===void 0)&&n.focusGuard))},C=function(r){return!U(r)},Ir=function(r){return!!r},Fr=function(r,n){var e=Math.max(0,r.tabIndex),t=Math.max(0,n.tabIndex),u=e-t,a=r.index-n.index;if(u){if(!e)return 1;if(!t)return-1}return u||a},Ar=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},_=function(r,n,e){return b(r).map(function(t,u){var a=Ar(t);return{node:t,index:u,tabIndex:e&&a===-1?(t.dataset||{}).focusGuard?0:-1:a}}).filter(function(t){return!n||t.tabIndex>=0}).sort(Fr)},wr=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],R=wr.join(","),Tr="".concat(R,", [data-focus-guard]"),ar=function(r,n){return b((r.shadowRoot||r).children).reduce(function(e,t){return e.concat(t.matches(n?Tr:R)?[t]:[],ar(t))},[])},Er=function(r,n){var e;return r instanceof HTMLIFrameElement&&(!((e=r.contentDocument)===null||e===void 0)&&e.body)?p([r.contentDocument.body],n):[r]},p=function(r,n){return r.reduce(function(e,t){var u,a=ar(t,n),o=(u=[]).concat.apply(u,a.map(function(c){return Er(c,n)}));return e.concat(o,t.parentNode?b(t.parentNode.querySelectorAll(R)).filter(function(c){return c===t}):[])},[])},Nr=function(r){var n=r.querySelectorAll("[".concat(sr,"]"));return b(n).map(function(e){return p([e])}).reduce(function(e,t){return e.concat(t)},[])},W=function(r,n){return b(r).filter(function(e){return rr(n,e)}).filter(function(e){return yr(e)})},K=function(r,n){return n===void 0&&(n=new Map),b(r).filter(function(e){return nr(n,e)})},B=function(r,n,e){return _(W(p(r,e),n),!0,e)},N=function(r,n){return _(W(p(r),n),!1)},Sr=function(r,n){return W(Nr(r),n)},O=function(r,n){return r.shadowRoot?O(r.shadowRoot,n):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,n)?!0:b(r.children).some(function(e){var t;if(e instanceof HTMLIFrameElement){var u=(t=e.contentDocument)===null||t===void 0?void 0:t.body;return u?O(u,n):!1}return O(e,n)})},Mr=function(r){for(var n=new Set,e=r.length,t=0;t<e;t+=1)for(var u=t+1;u<e;u+=1){var a=r[t].compareDocumentPosition(r[u]);(a&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&n.add(u),(a&Node.DOCUMENT_POSITION_CONTAINS)>0&&n.add(t)}return r.filter(function(o,c){return!n.has(c)})},or=function(r){return r.parentNode?or(r.parentNode):r},L=function(r){var n=y(r);return n.filter(Boolean).reduce(function(e,t){var u=t.getAttribute(j);return e.push.apply(e,u?Mr(b(or(t).querySelectorAll("[".concat(j,'="').concat(u,'"]:not([').concat(dr,'="disabled"])')))):[t]),e},[])},Dr=function(r){try{return r()}catch{return}},w=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var n=r.activeElement;return n.shadowRoot?w(n.shadowRoot):n instanceof HTMLIFrameElement&&Dr(function(){return n.contentWindow.document})?w(n.contentWindow.document):n}},Cr=function(r,n){return r===n},Pr=function(r,n){return!!b(r.querySelectorAll("iframe")).some(function(e){return Cr(e,n)})},jr=function(r,n){return n===void 0&&(n=w(X(r).ownerDocument)),!n||n.dataset&&n.dataset.focusGuard?!1:L(r).some(function(e){return O(e,n)||Pr(e,n)})},Kr=function(r){r===void 0&&(r=document);var n=w(r);return n?b(r.querySelectorAll("[".concat(lr,"]"))).some(function(e){return O(e,n)}):!1},kr=function(r,n){return n.filter(ur).filter(function(e){return e.name===r.name}).filter(function(e){return e.checked})[0]||r},H=function(r,n){return ur(r)&&r.name?kr(r,n):r},Ur=function(r){var n=new Set;return r.forEach(function(e){return n.add(H(e,r))}),r.filter(function(e){return n.has(e)})},Y=function(r){return r[0]&&r.length>1?H(r[0],r):r[0]},z=function(r,n){return r.indexOf(H(n,r))},P="NEW_FOCUS",_r=function(r,n,e,t,u){var a=r.length,o=r[0],c=r[a-1],m=U(t);if(!(t&&r.indexOf(t)>=0)){var i=t!==void 0?e.indexOf(t):-1,g=u?e.indexOf(u):i,f=u?r.indexOf(u):-1;if(i===-1)return f!==-1?f:P;if(f===-1)return P;var v=i-g,s=e.indexOf(o),l=e.indexOf(c),d=Ur(e),T=t!==void 0?d.indexOf(t):-1,I=u?d.indexOf(u):T,h=d.filter(function(vr){return vr.tabIndex>=0}),x=t!==void 0?h.indexOf(t):-1,F=u?h.indexOf(u):x,E=x>=0&&F>=0?F-x:I-T;if(!v&&f>=0||n.length===0)return f;var G=z(r,n[0]),V=z(r,n[n.length-1]);if(i<=s&&m&&Math.abs(v)>1)return V;if(i>=l&&m&&Math.abs(v)>1)return G;if(v&&Math.abs(E)>1)return f;if(i<=s)return V;if(i>l)return G;if(v)return Math.abs(v)>1?f:(a+f+v)%a}},Rr=function(r){return function(n){var e,t=(e=er(n))===null||e===void 0?void 0:e.autofocus;return n.autofocus||t!==void 0&&t!=="false"||r.indexOf(n)>=0}},J=function(r,n,e){var t=r.map(function(a){var o=a.node;return o}),u=K(t.filter(Rr(e)));return u&&u.length?Y(u):Y(K(n))},k=function(r,n){return n===void 0&&(n=[]),n.push(r),r.parentNode&&k(r.parentNode.host||r.parentNode,n),n},S=function(r,n){for(var e=k(r),t=k(n),u=0;u<e.length;u+=1){var a=e[u];if(t.indexOf(a)>=0)return a}return!1},ir=function(r,n,e){var t=y(r),u=y(n),a=t[0],o=!1;return u.filter(Boolean).forEach(function(c){o=S(o||c,c)||o,e.filter(Boolean).forEach(function(m){var i=S(a,m);i&&(!o||O(i,o)?o=i:o=S(i,o))})}),o},Q=function(r,n){return r.reduce(function(e,t){return e.concat(Sr(t,n))},[])},Wr=function(r,n){var e=new Map;return n.forEach(function(t){return e.set(t.node,t)}),r.map(function(t){return e.get(t)}).filter(Ir)},Br=function(r,n){var e=w(y(r).length>0?document:X(r).ownerDocument),t=L(r).filter(C),u=ir(e||r,r,t),a=new Map,o=N(t,a),c=o.filter(function(l){var d=l.node;return C(d)});if(c[0]){var m=N([u],a).map(function(l){var d=l.node;return d}),i=Wr(m,c),g=i.map(function(l){var d=l.node;return d}),f=i.filter(function(l){var d=l.tabIndex;return d>=0}).map(function(l){var d=l.node;return d}),v=_r(g,f,m,e,n);if(v===P){var s=J(o,f,Q(t,a))||J(o,g,Q(t,a));if(s)return{node:s};console.warn("focus-lock: cannot find any node to move focus into");return}return v===void 0?v:i[v]}},Yr=function(r){var n=L(r).filter(C),e=ir(r,r,n),t=_(p([e],!0),!0,!0),u=p(n,!1);return t.map(function(a){var o=a.node,c=a.index;return{node:o,index:c,lockItem:u.indexOf(o)>=0,guard:U(o)}})},q=function(r,n){r&&("focus"in r&&r.focus(n),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},M=0,D=!1,zr=function(r,n,e){e===void 0&&(e={});var t=Br(r,n);if(!D&&t){if(M>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),D=!0,setTimeout(function(){D=!1},1);return}M++,q(t.node,e.focusOptions),M--}};function A(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var n=r?new WeakRef(r):null;return function(){return(n==null?void 0:n.deref())||null}}var Lr=function(r){if(!r)return null;for(var n=[],e=r;e&&e!==document.body;)n.push({current:A(e),parent:A(e.parentElement),left:A(e.previousElementSibling),right:A(e.nextElementSibling)}),e=e.parentElement;return{element:A(r),stack:n,ownerDocument:r.ownerDocument}},Hr=function(r){var n,e,t,u,a;if(r)for(var o=r.stack,c=r.ownerDocument,m=new Map,i=0,g=o;i<g.length;i++){var f=g[i],v=(n=f.parent)===null||n===void 0?void 0:n.call(f);if(v&&c.contains(v)){for(var s=(e=f.left)===null||e===void 0?void 0:e.call(f),l=f.current(),d=v.contains(l)?l:void 0,T=(t=f.right)===null||t===void 0?void 0:t.call(f),I=B([v],m),h=(a=(u=d??(s==null?void 0:s.nextElementSibling))!==null&&u!==void 0?u:T)!==null&&a!==void 0?a:s;h;){for(var x=0,F=I;x<F.length;x++){var E=F[x];if(h!=null&&h.contains(E.node))return E.node}h=h.nextElementSibling}if(I.length)return I[0].node}}},Jr=function(r){var n=Lr(r);return function(){return Hr(n)}},qr=function(r,n,e){if(!r||!n)return console.error("no element or scope given"),{};var t=y(n);if(t.every(function(o){return!O(o,r)}))return console.error("Active element is not contained in the scope"),{};var u=e?B(t,new Map):N(t,new Map),a=u.findIndex(function(o){var c=o.node;return c===r});if(a!==-1)return{prev:u[a-1],next:u[a+1],first:u[0],last:u[u.length-1]}},Gr=function(r,n){var e=n?B(y(r),new Map):N(y(r),new Map);return{first:e[0],last:e[e.length-1]}},Vr=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},fr=function(r,n,e){n===void 0&&(n={});var t=Vr(n),u=qr(r,t.scope,t.onlyTabbable);if(u){var a=e(u,t.cycle);a&&q(a.node,t.focusOptions)}},Qr=function(r,n){n===void 0&&(n={}),fr(r,n,function(e,t){var u=e.next,a=e.first;return u||t&&a})},Xr=function(r,n){n===void 0&&(n={}),fr(r,n,function(e,t){var u=e.prev,a=e.last;return u||t&&a})},cr=function(r,n,e){var t,u=Gr(r,(t=n.onlyTabbable)!==null&&t!==void 0?t:!0),a=u[e];a&&q(a.node,n.focusOptions)},Zr=function(r,n){n===void 0&&(n={}),cr(r,n,"first")},$r=function(r,n){n===void 0&&(n={}),cr(r,n,"last")};export{dr as F,j as a,Zr as b,Jr as c,Xr as d,Qr as e,$r as f,jr as g,Yr as h,Kr as i,N as j,zr as m};
