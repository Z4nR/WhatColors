import{r as o,a as h}from"./react-_28KP_89.js";import{_ as N,c as ke}from"./@babel-C59Io369.js";import{F as Oe,a as Ge,c as Z,f as Be,b as Me,d as _e,e as He,g as ee,m as te,h as $e,i as Ne,j as Te}from"./focus-lock-8w9XvAej.js";import{c as T,a as De}from"./use-sidecar-B3fFPU3f.js";import{u as Ue}from"./use-callback-ref-2hXtW-gR.js";import{w as je}from"./react-clientside-effect-DSyoOPjp.js";var $={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},re=T({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),ne=T(),Ae=T(),qe=De({async:!0,ssr:typeof document<"u"}),Ve=o.createContext(void 0),ze=[],D=o.forwardRef(function(e,t){var n,u=o.useState(),s=u[0],m=u[1],F=o.useRef(),p=o.useRef(!1),g=o.useRef(null),S=o.useState({}),I=S[1],i=e.children,b=e.disabled,d=b===void 0?!1:b,W=e.noFocusGuards,f=W===void 0?!1:W,E=e.persistentFocus,l=E===void 0?!1:E,c=e.crossFrame,C=c===void 0?!0:c,k=e.autoFocus,B=k===void 0?!0:k;e.allowTextSelection;var fe=e.group,le=e.className,ve=e.whiteList,me=e.hasPositiveIndices,q=e.shards,M=q===void 0?ze:q,V=e.as,Fe=V===void 0?"div":V,z=e.lockProps,be=z===void 0?{}:z,he=e.sideCar,J=e.returnFocus,O=J===void 0?!1:J,pe=e.focusOptions,_=e.onActivation,H=e.onDeactivation,ge=o.useState({}),ye=ge[0],Ee=o.useCallback(function(v){var P=v.captureFocusRestore;if(!g.current){var w,y=(w=document)==null?void 0:w.activeElement;g.current=y,y!==document.body&&(g.current=P(y))}F.current&&_&&_(F.current),p.current=!0,I()},[_]),Ce=o.useCallback(function(){p.current=!1,H&&H(F.current),I()},[H]),Pe=o.useCallback(function(v){var P=g.current;if(P){var w=(typeof P=="function"?P():P)||document.body,y=typeof O=="function"?O(w):O;if(y){var Q=typeof y=="object"?y:void 0;g.current=null,v?Promise.resolve().then(function(){return w.focus(Q)}):w.focus(Q)}}},[O]),we=o.useCallback(function(v){p.current&&re.useMedium(v)},[]),xe=ne.useMedium,Le=o.useCallback(function(v){F.current!==v&&(F.current=v,m(v))},[]),Se=N((n={},n[Oe]=d&&"disabled",n[Ge]=fe,n),be),K=f!==!0,Ie=K&&f!=="tail",Re=Ue([t,Le]),We=o.useMemo(function(){return{observed:F,shards:M,enabled:!d,active:p.current}},[d,p.current,M,s]);return h.createElement(o.Fragment,null,K&&[h.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:d?-1:0,style:$}),me?h.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:d?-1:1,style:$}):null],!d&&h.createElement(he,{id:ye,sideCar:qe,observed:s,disabled:d,persistentFocus:l,crossFrame:C,autoFocus:B,whiteList:ve,shards:M,onActivation:Ee,onDeactivation:Ce,returnFocus:Pe,focusOptions:pe,noFocusGuards:f}),h.createElement(Fe,N({ref:Re},Se,{className:le,onBlur:xe,onFocus:we}),h.createElement(Ve.Provider,{value:We},i)),Ie&&h.createElement("div",{"data-focus-guard":!0,tabIndex:d?-1:0,style:$}))});D.propTypes={};function U(r){setTimeout(r,1)}var Je=function(e){return e&&"current"in e?e.current:e},oe=function(){return document&&document.activeElement===document.body},Ke=function(){return oe()||Ne()},x=null,a=null,X=function(){return null},L=null,R=!1,j=!1,Qe=function(){return!0},Xe=function(e){return(x.whiteList||Qe)(e)},Ye=function(e,t){L={observerNode:e,portaledElement:t}},Ze=function(e){return L&&L.portaledElement===e};function Y(r,e,t,n){var u=null,s=r;do{var m=n[s];if(m.guard)m.node.dataset.focusAutoGuard&&(u=m);else if(m.lockItem){if(s!==r)return;u=null}else break}while((s+=t)!==e);u&&(u.node.tabIndex=0)}var et=function(e){return e?!!R:R==="meanwhile"},tt=function r(e,t,n){return t&&(t.host===e&&(!t.activeElement||n.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,n))},rt=function(e,t){return t.some(function(n){return tt(e,n,n)})},ae=function(e){return Te(e,new Map)},nt=function(e){return!ae([e.parentNode]).some(function(t){return t.node===e})},G=function(){var e=!1;if(x){var t=x,n=t.observed,u=t.persistentFocus,s=t.autoFocus,m=t.shards,F=t.crossFrame,p=t.focusOptions,g=t.noFocusGuards,S=n||L&&L.portaledElement;if(oe()&&a&&a!==document.body&&(!document.body.contains(a)||nt(a))){var I=X();I&&I.focus()}var i=document&&document.activeElement;if(S){var b=[S].concat(m.map(Je).filter(Boolean)),d=function(){if(!et(F)||!g||!a||j)return!1;var c=ae(b),C=c.findIndex(function(k){var B=k.node;return B===a});return C===0||C===c.length-1};if((!i||Xe(i))&&(u||d()||!Ke()||!a&&s)&&(S&&!(ee(b)||i&&rt(i,b)||Ze(i))&&(document&&!a&&i&&!s?(i.blur&&i.blur(),document.body.focus()):(e=te(b,a,{focusOptions:p}),L={})),a=document&&document.activeElement,a!==document.body&&(X=Z(a)),R=!1),document&&i!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var W=document&&document.activeElement,f=$e(b),E=f.map(function(l){var c=l.node;return c}).indexOf(W);E>-1&&(f.filter(function(l){var c=l.guard,C=l.node;return c&&C.dataset.focusAutoGuard}).forEach(function(l){var c=l.node;return c.removeAttribute("tabIndex")}),Y(E,f.length,1,f),Y(E,-1,-1,f))}}}return e},ue=function(e){G()&&e&&(e.stopPropagation(),e.preventDefault())},A=function(){return U(G)},ot=function(e){var t=e.target,n=e.currentTarget;n.contains(t)||Ye(n,t)},at=function(){return null},se=function(){j=!0},ie=function(){j=!1,R="just",U(function(){R="meanwhile"})},ut=function(){document.addEventListener("focusin",ue),document.addEventListener("focusout",A),window.addEventListener("focus",se),window.addEventListener("blur",ie)},st=function(){document.removeEventListener("focusin",ue),document.removeEventListener("focusout",A),window.removeEventListener("focus",se),window.removeEventListener("blur",ie)};function it(r){return r.filter(function(e){var t=e.disabled;return!t})}var ce={moveFocusInside:te,focusInside:ee,focusNextElement:He,focusPrevElement:_e,focusFirstElement:Me,focusLastElement:Be,captureFocusRestore:Z};function ct(r){var e=r.slice(-1)[0];e&&!x&&ut();var t=x,n=t&&e&&e.id===t.id;x=e,t&&!n&&(t.onDeactivation(),r.filter(function(u){var s=u.id;return s===t.id}).length||t.returnFocus(!e)),e?(a=null,(!n||t.observed!==e.observed)&&e.onActivation(ce),G(),U(G)):(st(),a=null)}re.assignSyncMedium(ot);ne.assignMedium(A);Ae.assignMedium(function(r){return r(ce)});const dt=je(it,ct)(at);var ft=o.forwardRef(function(e,t){return h.createElement(D,N({sideCar:dt,ref:t},e))}),de=D.propTypes||{};de.sideCar;ke(de,["sideCar"]);ft.propTypes={};export{ft as F};
